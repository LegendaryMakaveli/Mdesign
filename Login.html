<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login or Create Profile - MDesigns</title>
    <link rel="stylesheet" href="login.css" />

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  </head>
  <body>
    <nav class="navbar">
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
      </ul>
    </nav>

    <div class="login-container">
      <h1>Login or Create Profile</h1>

      <div class="form-container">
        <button id="show-login" class="toggle-btn active">Login</button>
        <button id="show-signup" class="toggle-btn">Create Profile</button>

        <form id="login-form" class="form active">
          <input type="email" id="login-email" placeholder="Email" required />
          <input
            type="password"
            id="login-password"
            placeholder="Password"
            required
          />
          <button type="submit">Login</button>
        </form>

        <form id="signup-form" class="form">
          <input
            type="text"
            id="signup-name"
            placeholder="Full Name"
            required
          />
          <input type="email" id="signup-email" placeholder="Email" required />
          <input
            type="password"
            id="signup-password"
            placeholder="Password"
            required
          />
          <button type="submit">Create Profile</button>
        </form>
      </div>
    </div>

    <script src="firebase-config.js"></script>
    <script>
      //switching betwween login and signup

      document.addEventListener("DOMContentLoaded", () => {
        const loginBtn = document.getElementById("show-login");
        const signupBtn = document.getElementById("show-signup");
        const loginForm = document.getElementById("login-form");
        const signupForm = document.getElementById("signup-form");

        loginBtn.addEventListener("click", () => {
          loginForm.classList.add("active");
          signupForm.classList.remove("active");
          loginBtn.classList.add("active");
          signupBtn.classList.remove("active");
        });

        signupBtn.addEventListener("click", () => {
          signupForm.classList.add("active");
          loginForm.classList.remove("active");
          signupBtn.classList.add("active");
          loginBtn.classList.remove("active");
        });
      });

      document.addEventListener("DOMContentLoaded", () => {
        // ✅ Signup Form Event Listener
        const signupForm = document.getElementById("signup-form");
        if (signupForm) {
          signupForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const name = document.getElementById("signup-name").value.trim();
            const email = document.getElementById("signup-email").value.trim();
            const password = document
              .getElementById("signup-password")
              .value.trim();

            if (!name || !email || !password) {
              alert("All fields are required.");
              return;
            }

            try {
              const res = await fetch("http:// 172.20.10.3:5000/api/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, email, password }),
              });

              const data = await res.json();
              console.log("Signup Response:", data); // ✅ Debugging

              if (res.ok) {
                localStorage.setItem("token", data.token);
                window.location.href = "dashboard.html"; // ✅ Redirect to dashboard
              } else {
                alert(data.message || "Signup failed. Please try again.");
              }
            } catch (error) {
              console.error("Signup Error:", error);
              alert("An error occurred during signup. Please try again.");
            }
          });
        }

        // ✅ Login Form Event Listener
        const loginForm = document.getElementById("login-form");
        if (loginForm) {
          loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const email = document.getElementById("login-email").value.trim();
            const password = document
              .getElementById("login-password")
              .value.trim();

            if (!email || !password) {
              alert("Email and password are required.");
              return;
            }

            try {
              const res = await fetch("http:// 172.20.10.3:5000/api/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password }),
              });

              const data = await res.json();
              console.log("Login Response:", data); // ✅ Debugging

              if (res.ok) {
                localStorage.setItem("token", data.token);
                window.location.href = "dashboard.html"; // ✅ Redirect to dashboard
              } else {
                alert(data.message || "Invalid credentials");
              }
            } catch (error) {
              console.error("Login Error:", error);
              alert("An error occurred during login. Please try again.");
            }
          });
        }
      });
    </script>
    <script src="script.js"></script>
  </body>
</html>
